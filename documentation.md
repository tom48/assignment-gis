# Overview

This application shows riverways and waterways in and near Bratislava on a map. Most important features are:
- search by distance (given by user) from specified location
- search by time (given by user) from specified location
- search shortest path between 2 specified locations

This is it in action (search by time):

![Screenshot](screenshot.png)

The application has 2 separate parts, the client which is a [frontend web application](#frontend) using leaflet API, leaflet.js and my own controller.js and the [backend application](#backend) written in [ExpressJS](https://expressjs.com/), backed by PostGIS. The frontend application mostly communicates with backend using a [JQuery](#api).

# Frontend

The frontend application is a static HTML page (`index.jade`), which shows a leaflet.js widget. It is displaying riverways and waterways, following parameters given by user. I modified the style to better highlight water routes on red color and weight 6.

All relevant frontend code is in `controller.js` which is referenced from `index.jade` which extends `layout.jade`. The frontend code is very simple, its only responsibilities are:
- showing user's location on clicks
- calling right API url on specific actions
- displaying geo features by overlaying the map with a geojson layer, the geojson is provided directly by backend APIs

# Backend

The backend application is written in JavaScript and is responsible for querying geo data from PostGIS, formatting the geojson and returning data to frontend.

## Data

Hotel data is coming directly from Open Street Maps. I downloaded an covering for city Bratislava (around 300 MB) and imported it using the `osm2pgrouting` tool into the specific schema for shortest paths querying. All queries are placed inside of `index.js`. GeoJSON is generated by using a standard `st_asgeojson` function which is packed with other properties as Features in FeatureCollection and everything together is packed with `row_to_json` function. This format is then easier to display by leaflet functions. 

## Api

**Find water routes by distance**

`http://localhost:3000/withDistance?pointLat=48.16806039574837&pointLon=17.29127883911133&dist=20000`

**Find water routes by time**

`http://localhost:3000/withTime?pointLat=48.16806039574837&pointLon=17.29127883911133&dist=14400`

**Find water route between two specified points**

`http://localhost:3000/withTwoPoints?pointLat1=48.16806039574837&pointLon1=17.29127883911133&pointLat2=48.23586468129449&pointLon2=17.20441818237305`

### Response

API calls return json responses with following format:

`{"type":"FeatureCollection",
	"features":[{"type":"Feature",
		"geometry":{"type":"LineString",
			"coordinates":[[17.2634268,48.1643394],[17.2636403,48.1637354],.....]
		},
		"properties":{"f1":59,"f2":"1392.77403618444"}}
	]
}`
